---
layout: post
title: "SS-week7"
date: 2017-03-31 10:37:03 +0800
comments: true
categories: Service_Security
---

# Web Services and Security

<!--more-->

## Internet and TCP/IP

- [ç§‘æ™®æ™‚é–“](http://www.youtube.com/watch?v=9hIQjrMHTv4)
- ä½†è€å¸«é€£å­—å¹•éƒ½æ²’é–‹è®Šæˆåœ¨è½åŠ›æ¸¬é©—QQ

## HTTP:

- Persistent but Stateless
- not a whole conversation
- just a line of message/request
- Request and Resoinse Msg

- (HTTPie)[https://httpie.org] : cmd tool designed for painless debugging and interaction with HTTP servers, RESTful APIs, and web services

## HTTP methods

- Safety : Never change the resources
- Idempotence : can be called many times without different outcome

| HTTP method | Safety | Idempotence |
| ------------|--------|-------------|
|GET          | Y      |Y            |
|POST         | N      |N            |
|PUT          | N      |Y            |
|DELETE       | N      |Y            |

- usage example :
google search use GET method
GET parameter is saved in url so that you can save the search result as a bookmark

## HTTP status code

- DON'T be lazy, lookup  the [table](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes)

---

# Happy(Coding) time ~ ä¹‹å‰è¦å…ˆæœ‰

# å‡ºå ´äººå“¡ä»‹ç´¹ğŸ‘ğŸ‘ğŸ‘

## [Sinatra](https://github.com/sinatra/sinatra)
- Web Application Framework
- Sinatra is a DSL for quickly creating web applications in Ruby with minimal effort
(ä»‹ç´¹å°±é€™éº¼ç°¡çŸ­ï¼Œå®˜ç¶²ç”šè‡³ä¸€é€²å»åªçœ‹åˆ°sample code)

### run server

- Execute Rack based web application as per config.ru

``` bat
rackup
```

## [Bundler](http://bundler.io)
- provides a consistent environment for Ruby projects by tracking and installing the exact gems and versions that are needed.

### install

``` bat
gem install bundler
```

### execution

``` bat
bundle install
```

- Gemfile.lock stores which version of gems should be installed

### execution(suggestion)

``` bat
bundle exec rake
```

- ensures following command is only run with gems specified in Gemfile.lock

## [rake](https://github.com/ruby/rake)
- Ruby make

### simple example

``` ruby task simple

task default: %w[test]
task :test do
  ruby "test/unittest.rb"
end

```

---

# çœŸæ­£çš„coding time~

Ruby èªæ³•çš„éƒ¨åˆ†å°±ç•¥éä¸èªªäº†

## model
- ä¸€èˆ¬çš„class
- é€™æ¬¡spec è¦æ±‚implement ä¸‹åˆ— methods
  - initialize
  - save
  - find
  - all
  - to_json

## controller
- å¿…éœ€ç¹¼æ‰¿ Sinatra::Base, rackæ‰èªå¾—å®ƒ
- requirement
  - get /sourece : return details of a specific resource
  - get /sourece/id : return an index of all resources
  - post : create a new resource

``` ruby

class ShareConfigurationsAPI < Sinatra::Base
  configure do
    #Configure Sinatra settings
  end

  get '/?' do
    # root route for anything
  end

  post '/api/v1/configurations/?' do
    # a post route
  end
end

```

---

## Security Threats

ç•¶ç„¶ç›®å‰çš„æœå‹™å¾ˆç°¡å–®ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ¼æ´
ä¸‹é¢åˆ—äº†ä¸€äº›ï¼Œä¹‹å¾Œæˆ‘å€‘éƒ½æœƒä¸€å€‹ä¸€å€‹ä¾†è§£æ±º

- Threat: Confidentiality
	* Stored resources could be stolen if server is compromised
	* Vulnerability: User resources are not being encrypted
	* Vector: Attacker with access to server can read whole data store

- Threat: Authorization, Authentication
	* Information about resources is not private
	* Vulnerability: App does not check if user is authorized to see resource
	* Vector: Anyone can access any data by knowing its public URL

- Threat: Integrity, Bug
	* :id random key generator could produce collisions
	* Vulnerability: random key generator produces same keys within given second
	* Vector: send multiple POST '/resource' requests within same second

- Threat: Integrity
	* User could destroy earlier resources
	* Vulnerability: app does not check if :id key is being sent along with POST request
	* Vector: send :id along with POST request to see if app overwrite earlier resource

- Threat: All dimensions
	* Dependencies (gems) could have vulnerabilities
	* Vulnerability: gems could allow attacks (denial of service, remote code execution, etc.)
	* Vector: send a payload to a route that will likely invoke a particular dependency (gem)
